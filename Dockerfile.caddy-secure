FROM caddy:2.7-alpine@sha256:2e1d4592f1718bb47645da5a83a846fe19094f18e6c921fdf56d174f05c63213

# Install libcap for setcap command
RUN apk add --no-cache libcap

# Give Caddy capability to bind to privileged ports
RUN setcap 'cap_net_bind_service=+ep' /usr/bin/caddy

# Create non-root user with specific UID
RUN adduser -D -u 1001 caddyuser

# Change ownership of required directories
RUN mkdir -p /data /config && \
    chown -R 1001:1001 /data /config

# Switch to non-root user
USER 1001

EXPOSE 80 443